---

# oraclejdk
#
# Dependencies:
#
#   * common
#
# Example play:
#
#   roles:
#   - common
#   - oraclejdk

- name: download Oracle Java
  get_url:
    url: "{{ oraclejdk_s3_url }}"    
    dest: "{{ oraclejdk_tmp_dir }}/{{ oraclejdk_s3_file }}"    
    force: yes

- name: create jvm dir
  file: >
    path=/usr/lib/jvm
    state=directory
    owner=root
    group=root

- name: untar Oracle Java
  shell: >
    tar -C /usr/lib/jvm -zxvf {{ oraclejdk_tmp_dir }}/{{ oraclejdk_file }}
    executable=/bin/bash
    creates=/usr/lib/jvm/{{ oraclejdk_base }}

- name: create symlink expected by elasticsearch
  file: src=/usr/lib/jvm/{{ oraclejdk_base }} dest={{ oraclejdk_link }} state=link force=yes

- name: update alternatives java
  alternatives: >
    name={{ item }}
    link="/usr/bin/{{ item }}"
    path="/usr/lib/jvm/{{ oraclejdk_base }}/bin/{{ item }}"
  with_items:
    - java
    - javac
    - javaws

- name: add JAVA_HOME for Oracle Java
  template: src=java.sh.j2 dest=/etc/profile.d/java.sh owner=root group=root mode=0755
